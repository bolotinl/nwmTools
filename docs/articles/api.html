<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Historic Records • National Water Model</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../bootstrap.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../mikepkgdown.css" rel="stylesheet">
<meta property="og:title" content="Historic Records">
<meta property="og:description" content="nwmTools">
<meta property="og:image" content="https://github.com/mikejohnson51/nwmHistoric/logo.svg">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
                                                                          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
                                                                            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
                                                                              <![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
              <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                  </button>
                  
                  <div class="navbar-brand-container">
                    <a class="navbar-brand" href="../index.html">nwmTools</a>
                      <div class="info">
                        <span class="partof">National Water Model</span>
                          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
                            </div>
                              </div>
                              </div>
                              <div id="navbar" class="navbar-collapse collapse">
                                <ul class="nav navbar-nav navbar-left">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/api.html">Historic Records</a>
    </li>
    <li>
      <a href="../articles/discovery.html">Feature Discovery</a>
    </li>
    <li>
      <a href="../articles/operations.html">Operational Forecasts</a>
    </li>
    <li>
      <a href="../articles/time.html">Time Aggregation{s}</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
                                </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mikejohnson51/nwmTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
                                </ul>
</div>
<!--/.nav-collapse -->
                                          </div>
<!--/.container -->
                                          </div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Historic Records</h1>
                        <h4 data-toc-skip class="author"><a href="mailto:mikecp11@gmail.com" class="email">mikecp11@gmail.com</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikejohnson51/nwmTools/blob/HEAD/vignettes/api.Rmd" class="external-link"><code>vignettes/api.Rmd</code></a></small>
      <div class="hidden name"><code>api.Rmd</code></div>

    </div>

    
    
<p>As part of a collaborative research effort, the multi-decadal historic simulation products from the <a href="https://water.noaa.gov/about/nwm" class="external-link">NOAA National Water Model</a> (versions 1.2, 2.0, and 2.1) have been reformatted and exposed through <a href="https://www.cuahsi.org/" class="external-link">CUAHSI</a> at the <a href="https://renci.org/research/hydroshare/" class="external-link">RENCI computing facility</a>. This document outlines how to interact with this interface.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_nwm_meta.html">get_nwm_meta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2.0</span>, <span class="fl">2.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="11%">
<col width="20%">
<col width="20%">
<col width="24%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="right">version</th>
<th align="left">type</th>
<th align="left">minDate</th>
<th align="left">maxDate</th>
<th align="left">ncml</th>
<th align="left">varname</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1.2</td>
<td align="left">hydroshare</td>
<td align="left">1993-01-01 00:00:00</td>
<td align="left">2017-12-31 23:00:00</td>
<td align="left">nwm_retro_full.ncml</td>
<td align="left">feature_ids_v12</td>
</tr>
<tr class="even">
<td align="right">2.0</td>
<td align="left">hydroshare</td>
<td align="left">1993-01-01 00:00:00</td>
<td align="left">2018-12-31 00:00:00</td>
<td align="left">nwm_v2_retro_full.ncml</td>
<td align="left">feature_ids_v20</td>
</tr>
<tr class="odd">
<td align="right">2.1</td>
<td align="left">USGS</td>
<td align="left">1979-02-02 18:00:00</td>
<td align="left">2020-12-31 00:00:00</td>
<td align="left">nwm_v21_retro_full.ncml</td>
<td align="left">feature_ids_v21</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="data-extraction-by">Data Extraction by …<a class="anchor" aria-label="anchor" href="#data-extraction-by"></a>
</h2>
<p>Reanalysis data can be found with the <code>readNWMdata</code> function. The API requires users to specify NHD Common Identifier(s) (COMID), or NWIS site ID(s) for time series extraction.</p>
<div class="section level3">
<h3 id="nhd-catchment-identifier-comid">NHD Catchment Identifier (COMID)<a class="anchor" aria-label="anchor" href="#nhd-catchment-identifier-comid"></a>
</h3>
<p>NWM reanalysis data can be extracted by NHD Catchment Identifier(s). The following code pulls the complete reanalysis data archive for COMID 17595383, a NHD reach near Goleta, California.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikejohnson51/nwmTools" class="external-link">nwmTools</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">flows</span> <span class="op">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span><span class="op">(</span>comid <span class="op">=</span> <span class="fl">17595383</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.133   0.063   1.108</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span>
<span class="co">#&gt;      comid            dateTime flow_cms_v2.1</span>
<span class="co">#&gt; 1 17595383 1979-02-02 18:00:00          0.26</span>
<span class="co">#&gt; 2 17595383 1979-02-02 19:00:00          0.27</span>
<span class="co">#&gt; 3 17595383 1979-02-02 20:00:00          0.29</span>
<span class="co">#&gt; 4 17595383 1979-02-02 21:00:00          0.30</span>
<span class="co">#&gt; 5 17595383 1979-02-02 22:00:00          0.31</span>
<span class="co">#&gt; 6 17595383 1979-02-02 23:00:00          0.31</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span>
<span class="co">#&gt; [1] 367375      3</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="usgs-nwis-site-number">USGS NWIS Site Number<a class="anchor" aria-label="anchor" href="#usgs-nwis-site-number"></a>
</h3>
<p>Alternatively, data can be extracted using USGS NWIS site ID(s).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">flows</span> <span class="op">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span><span class="op">(</span>siteID  <span class="op">=</span> <span class="fl">11120000</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   2.846   0.194   4.028</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span>
<span class="co">#&gt;      comid            dateTime   siteID flow_cms_v2.1</span>
<span class="co">#&gt; 1 17595429 1979-02-02 18:00:00 11120000          0.52</span>
<span class="co">#&gt; 2 17595429 1979-02-02 19:00:00 11120000          0.52</span>
<span class="co">#&gt; 3 17595429 1979-02-02 20:00:00 11120000          0.53</span>
<span class="co">#&gt; 4 17595429 1979-02-02 21:00:00 11120000          0.55</span>
<span class="co">#&gt; 5 17595429 1979-02-02 22:00:00 11120000          0.55</span>
<span class="co">#&gt; 6 17595429 1979-02-02 23:00:00 11120000          0.55</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">flows</span><span class="op">)</span>
<span class="co">#&gt; [1] 367375      4</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="query-modification-by">Query modification by …<a class="anchor" aria-label="anchor" href="#query-modification-by"></a>
</h2>
<p>The default behavior is to extract the complete, hourly time series in UTC, for the most current model version. Parameters allow data to be modified by data range, timezone and model version as follows:</p>
<div class="section level3">
<h3 id="date-range">date range<a class="anchor" aria-label="anchor" href="#date-range"></a>
</h3>
<p>By default, the API extracts the complete flow record for each ID. This range can constrained by providing a <code>startDate</code> and/or <code>endDate</code> in the form of (“YYYY-MM-DD”).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">utc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span><span class="op">(</span>comid <span class="op">=</span> <span class="fl">101</span>, 
                     startDate <span class="op">=</span> <span class="st">"2010-01-01"</span>, 
                     endDate   <span class="op">=</span> <span class="st">"2010-01-31"</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.090   0.047   0.459</span>

<span class="co"># Check time dimensions</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">utc</span><span class="op">)</span>
<span class="co">#&gt; [1] 744   3</span>
<span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">utc</span><span class="op">$</span><span class="va">dateTime</span><span class="op">)</span>
<span class="co">#&gt; [1] "2010-01-01 00:00:00 UTC" "2010-01-31 23:00:00 UTC"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">utc</span><span class="op">)</span>
<span class="co">#&gt;   comid            dateTime flow_cms_v2.1</span>
<span class="co">#&gt; 1   101 2010-01-01 00:00:00      9.650000</span>
<span class="co">#&gt; 2   101 2010-01-01 01:00:00      9.620000</span>
<span class="co">#&gt; 3   101 2010-01-01 02:00:00      9.599999</span>
<span class="co">#&gt; 4   101 2010-01-01 03:00:00      9.599999</span>
<span class="co">#&gt; 5   101 2010-01-01 04:00:00      9.610000</span>
<span class="co">#&gt; 6   101 2010-01-01 05:00:00      9.599999</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="time-zone">time-zone<a class="anchor" aria-label="anchor" href="#time-zone"></a>
</h3>
<p>NWM output is recorded in UTC. Instead, users can specify a timezone. For our COMID in Goleta, California we can request data in <code>US/Pacific</code> time. Valid times zone can be found with <code><a href="https://rdrr.io/r/base/timezones.html" class="external-link">OlsonNames()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pst</span> <span class="op">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span><span class="op">(</span>comid <span class="op">=</span> <span class="fl">101</span>, 
                  startDate <span class="op">=</span> <span class="st">"2010-01-01"</span>, 
                  endDate <span class="op">=</span> <span class="st">"2010-01-31"</span>, 
                  tz <span class="op">=</span> <span class="st">"US/Pacific"</span><span class="op">)</span>

<span class="co"># Check time dimensions</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pst</span><span class="op">)</span>
<span class="co">#&gt; [1] 744   3</span>
<span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">pst</span><span class="op">$</span><span class="va">dateTime</span><span class="op">)</span>
<span class="co">#&gt; [1] "2010-01-01 00:00:00 PST" "2010-01-31 23:00:00 PST"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pst</span><span class="op">)</span>
<span class="co">#&gt;   comid            dateTime flow_cms_v2.1</span>
<span class="co">#&gt; 1   101 2010-01-01 00:00:00          9.42</span>
<span class="co">#&gt; 2   101 2010-01-01 01:00:00          9.32</span>
<span class="co">#&gt; 3   101 2010-01-01 02:00:00          9.22</span>
<span class="co">#&gt; 4   101 2010-01-01 03:00:00          9.15</span>
<span class="co">#&gt; 5   101 2010-01-01 04:00:00          9.12</span>
<span class="co">#&gt; 6   101 2010-01-01 05:00:00          9.13</span></code></pre></div>
<p>Finally, we can plot the UTC return against the PST return:</p>
<p><img src="api_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="model-versioning">Model versioning<a class="anchor" aria-label="anchor" href="#model-versioning"></a>
</h3>
<p>The reanalysis product for versions 1.2, 2.0, and 2.1 of the NWM are available. By default the API extracts data from version 2.1, but all versions can be requested.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pst_vs</span> <span class="op">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span><span class="op">(</span>comid <span class="op">=</span> <span class="fl">101</span>, 
                     startDate <span class="op">=</span> <span class="st">"2010-01-01"</span>, 
                     endDate   <span class="op">=</span> <span class="st">"2010-01-31"</span>,
                     tz        <span class="op">=</span> <span class="st">"US/Pacific"</span>,
                     version <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2.0</span>, <span class="fl">2.1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="api_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="model-version-vs-obs">model version vs obs<a class="anchor" aria-label="anchor" href="#model-version-vs-obs"></a>
</h3>
<p>In addition to extracting records from mulitple model runs, data can be appended from observation in the case a USGS gage ID is supplied:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span>
 <span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span><span class="op">(</span>siteID <span class="op">=</span> <span class="st">'01017000'</span>, 
            startDate <span class="op">=</span> <span class="st">"2015-01-01"</span>,
            endDate <span class="op">=</span> <span class="st">"2016-01-01"</span>,
            version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2.0</span>, <span class="fl">2.1</span><span class="op">)</span>,
            addObs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   6.775   0.416  17.347</span></code></pre></div>
<p><img src="api_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>In section 2, we will look at how we can facilitate COMID and USGS NWIS discovery. In section 3 we will look at some techniques to handle operational data, and in section 4, we will look at time aggregations and splitting.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer></footer>
</div>

  


  

  </body>
</html>
